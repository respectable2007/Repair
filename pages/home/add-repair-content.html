<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name='viewport' content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css"/>
		<style type="text/css">
		  aside .mui-content .mui-scroll-wrapper{
		    top: 70px;
		  }
		</style>
	</head>
	<body>
	  <div id="app" class="mui-off-canvas-wrap mui-slide-in">
	  	<!--菜单部分-->
	  	<aside class="mui-off-canvas-right" id='searchArea'>
	  	  <div class="mui-content">
	  	  	<div class="mui-input-row">
	  	  	  <input type="search" 
	  	  	  	     placeholder="请输入关键字"
	  	  	  	     class="mui-input-clear"
	  	  	  	     id='search'
	  	  	  	     v-model="search"
	  	  	  	     @keyup="handleSearchList($event)"/>
	  	  	  <a href="#searchArea" @tap='handleClearSearch()'>取消</a>
	  	  	</div>
	  	  	<div class="mui-scroll-wrapper">
		  	  <div class="mui-scroll">
		  	    <div v-show='search'>
		  	      <ul class="mui-table-view">
		  	      	<li v-for='item in autoSearchList'
		  	      		@tap='handleSelected(item)'
		  	      		class="mui-table-view-cell">
		              {{item.TITLE}}
		  	      	</li>
		  	      </ul>
		  	    </div>
		  	    <div v-show='!search.length'>
		  	      <!--历史记录-->
		  	      <ul class="mui-table-view">
		  	      	<li class="mui-table-view-cell mui-collapse mui-active">
		  	      	  <a href="javascript:void(0);"
		  	      	  	 class="mui-navigate-right">
		  	      	      历史记录
		  	      	  </a>
		  	      	  <div class="mui-collapse-content">
		  	      	  	<div class="mui-input-group" v-if='historyList.length'>
		  	      	  	  <div class="mui-input-row"
		  	      	  	  	   v-for='item in historyList'
		  	      	  	  	   @tap='handleHistoryDetail(item)'>
		  	      	  	  	{{item.name}}
		  	      	  	  </div>
		  	      	  	</div>
		  	      	  	<div class="mui-input-group" v-else>
		  	      	  	   <div class="mui-input-row">
		  	      	  	   	  暂无历史记录
		  	      	  	   </div>
		  	      	  	</div>
		  	      	  </div>
		  	      	  <span class="">
		  	      	  	<i class="mui-icon mui-icon-trash i-clear"></i>
		  	      	  </span>
		  	      	</li>
		  	      </ul>
		  	    </div>
		  	  </div>
		  	</div>
	  	  </div>
	  	</aside>
	  	<!--主页表单部分-->
	  	<div class="mui-inner-wrap">
	  	  <nav class="mui-bar mui-bar-tab">
	  	  	<button id='btnSubmit' type="button" class="mui-btn mui-btn-primary mui-btn-block">
	  	  	  提交
	  	  	</button>
	  	  </nav>
	  	  <div class="mui-content" id='mui-content'>
	  	  	<form class="mui-input-group">
	  	  	  <div v-if='repairType == 1'>
	  	  	  	<div>
	  	  	  	  <span>建筑信息</span>
	  	  	  	</div>
	  	  	  	<div>
	  	  	  	  <div>建筑名称</div>
	  	  	  	  <div v-text='data_v.BUILD_NAME'></div>
	  	  	  	</div>
	  	  	  </div>
	  	  	  <div v-else>
	  	  	  	<div class="mui-input-row mui-search readonly">
	  	  	  	  <a href="#searchArea">
	  	  	  	  	 <i class="mui-icon mui-icon-search"></i>
	  	  	  	  	 <span v-text="data_v.BUILD_NAME"></span>
	  	  	  	  </a>
	  	  	  	</div>
	  	  	  	<div class="mui-input-row">
	  	  	  	  <label>
	  	  	  	  	<i class="require">*</i>
	  	  	  	  	建筑地址
	  	  	  	  </label>
	  	  	  	  <input type="text" v-model='data_v.ADDRESS' placeholder="建筑地址" class="mui-navigate-right"/>
	  	  	  	</div>
	  	  	  </div>
	  	  	</form>
	  	  </div>
	  	</div>
	  </div>
	  <script src="../../js/mui.min.js" type  ="text/javascript"></script>
	  <script src="../../js/libs/vue.min.js" type  ="text/javascript"></script>
	  <script src="../../js/common/config.js" type  ="text/javascript"></script>
	  <script src="../../js/libs/mock-min.js" type  ="text/javascript"></script>
	  <script src="../../js/common/global.js" type  ="text/javascript"></script>
	  <script src="../../js/common/mockdata.js" type  ="text/javascript"></script>
	  <script type="text/javascript">
	  	mui.init();
        var defaultTxt = "搜索建筑名称（必填）",
            //分页
            pageSize = 1000,
            pageIndex = 0,
            start = 0,
            end = pageSize,
            dvAll = [],
            findData = [],//查找后集合
            operatorType = 0,//操作类型：1：代表下拉刷新，2：上拉加载
		    app = new Vue({
		      el: '#app',
		      data: {
		      	repairType:0,//文字报修
		      	data_v: {
		      	  BUILD_NAME: defaultTxt,
		      	  ADDRESS: ''
		      	},
		      	search: '',
		      	autoSearchList: [],
		      	historyList: [],
		      	buildWhere: {
		      	  start:0,
		      	  end:10,
		      	  lstOrgCode: config.ORG_CODE,
		      	  buildName: ''//建筑查询
		      	}
		      },
		      mounted: function() {
		      	mui.ready(function(){
		      	  getListAll();
		      	  g.initScroll({
			      	id: 'mui-content',
			        h: g.getScreenInfo('width')
			      })
		      	})
		      },
		      methods: {
		      	handleClearSearch: function() {
		      	  this.search = '';
		      	  findData = [];
		      	},
		      	handleSearchList: function(e){
		      	  this.search = e.target.value;
		      	  console.log( this.search);
		      	  getListByKey(e.target.value);
		      	},
		      	handleSelected: function(item) {
		      	  
		      	}
		      }
		    });
	  function getListAll() {
	  	pageIndex = 0;
	  	initSearch(pageIndex, pageSize);
	  	dvAll = [];
	  	operatorType = 0;
	  	toList(operatorType);
	  }
	  function initSearch(pageIndex, pageSize){
	  	if(app.buildWhere) {
	  	  app.buildWhere.start = pageIndex * pageSize;
	  	  app.buildWhere.end = pageIndex * pageSize + pageSize;
	  	  app.buildWhere.lstOrgCode = config.ORG_CODE;
	  	}
	  }
	  function toList(Type) {
	  	var nwaiting = window.plus === undefined ? null : plus.nativeUI.showWaiting();
	  	g.ajax(config.GetBuildsPage,{
	  	  data: initSearchWhere(app),
	  	  nwaiting: nwaiting,
	  	  success: function(data){
	  	  	var dv = [];
	  	  	if(data.StatusCode === 200) {
	  	  	  for(var i = 0, len = data.Data.List.length; i < len; i++){
	  	  	  	var d = {
	  	  	  	  ID: data.Data.List[i].BUILD_ID,
	  	  	  	  TITLE:data.Data.List[i].BUILD_NAME,
	  	  	  	  ADDRESS:data.Data.List[i].ADDRESS
	  	  	  	}
	  	  	  	dv.push(d);
	  	  	  	dvAll.push(d);
	  	  	  }
	  	  	}
	  	  	app.autoSearchList = dvAll;
	  	  	if(window.plus != undefined) {
	  	  	  plus.nativeUI.closeWaiting();
	  	  	}
	  	  },
	  	  error: function(){
	  	  	if(nwaiting){
	  	  	  nwaiting.close();
	  	  	}
	  	  }
	  	})
	  }
	  function initSearchWhere(app){
	  	if(app.buildWhere) {
	  	  app.buildWhere.buildName = app.search;
	  	  return app.buildWhere;
	  	}
	  }
	  function getListByKey(key) {
	  	findData = [];
	  	if(dvAll.length > 0) {
	  	  for(var i = 0, len = dvAll.length; i < len; i++) {
	  	  	if(dvAll[i].TITLE.indexOf(key) > -1) {
	  	  	  findData.push(dvAll[i]);
	  	  	}
	  	  }
	  	}
	  	app.autoSearchList = findData;
	  }
	  </script>
	</body>
</html>
